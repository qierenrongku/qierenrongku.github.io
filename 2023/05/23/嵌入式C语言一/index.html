<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="一个能把简单的事情做好的人就是一个不简单的人">
    <meta name="author" content="且任容枯">
    
    <title>
        
            嵌入式C语言一 |
        
        且任容枯
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"qierenrongku.github.io.git","root":"/","language":"zh-CN","path":"search.xml"};
    KEEP.theme_config = {"toc":{"enable":false,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":false,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":false}}},"local_search":{"enable":false,"preload":false},"code_copy":{"enable":false,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                且任容枯
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">嵌入式C语言一</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">且任容枯</span>
                        
                            <span class="author-label">Lv4</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2023-05-23 22:12:48</span>
        <span class="mobile">2023-05-23 22:12</span>
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/c/">c</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h2 id="工具安装"><a href="#工具安装" class="headerlink" title="工具安装"></a>工具安装</h2><p>ubuntu 安装vim</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install vim</span><br><span class="line">sudo apt-get install vim</span><br></pre></td></tr></table></figure>
<p>ubuntu 安装gcc</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install gcc</span><br><span class="line">sudo apt-get install gcc</span><br></pre></td></tr></table></figure>
<p>一个简单的C程序</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;hello world\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">qrrk@qrrk-virtual-machine:~/桌面$ vim main.c</span><br><span class="line">qrrk@qrrk-virtual-machine:~/桌面$ gcc -o hello main.c</span><br><span class="line">qrrk@qrrk-virtual-machine:~/桌面$ ./hello</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure>
<p>● -E：只对C源程序进行预处理，不编译。<br>● -S：只编译到汇编文件，不再汇编。<br>● -c：只编译生成目标文件，不进行链接。<br>● -o：指定输出的可执行文件名。<br>● -g：生成带有调试信息的debug文件。<br>● -O2：代码编译优化等级，一般选择2。<br>● -W：在编译中开启警告（warning）信息。<br>● -I：大写的I，在编译时指定头文件的路径。<br>● -l：小写的l（like首字母），指定程序使用的函数库。<br>● -L：大写的L（like首字母），指定函数库的路径。</p>
<p>使用make<br><img src="https://cdn.staticaly.com/gh/qierenrongku/images@master/Pastedimage20230517222907.1p5rq5vhuz40.webp" alt="Pastedimage20230517222907"><br>在同一级目录下编写makefile<br><img src="https://cdn.staticaly.com/gh/qierenrongku/images@master/Pastedimage20230517223409.7gel1sev8c00.webp" alt="Pastedimage20230517223409"><br>Git代码管理<br><a class="link"   target="_blank" rel="noopener" href="https://qierenrongku.github.io/2022/10/30/Git/" >Git | 且任容枯 (qierenrongku.github.io)<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="计算机体系结构和CPU工作原理"><a href="#计算机体系结构和CPU工作原理" class="headerlink" title="计算机体系结构和CPU工作原理"></a>计算机体系结构和CPU工作原理</h2><p>嵌入式开发很大一部分工作跟底层紧密相关，如系统移植、BSP开发、驱动开发等，和芯片、硬件打交道的地方比较多<br>BSP开发（BSP，全称Board Support Package，汉语意思即_板级支持包_，BSP工程师，顾名思义就是负责板级支持包的开发、调试和维护工作）</p>
<h3 id="cpu内部结构及工作原理"><a href="#cpu内部结构及工作原理" class="headerlink" title="cpu内部结构及工作原理"></a>cpu内部结构及工作原理</h3><p><img src="https://cdn.staticaly.com/gh/qierenrongku/images@master/Pastedimage20230517224041.3sbydiu7ea00.webp" alt="Pastedimage20230517224041"></p>
<h3 id="CPU设计流程"><a href="#CPU设计流程" class="headerlink" title="CPU设计流程"></a>CPU设计流程</h3><p><img src="https://cdn.staticaly.com/gh/qierenrongku/images@master/Pastedimage20230517224334.4ddjbuvvgrc0.webp" alt="Pastedimage20230517224334"></p>
<ul>
<li>设计芯片规格：设计出芯片基本的框架、功能，进行模块划分</li>
<li>HDL代码实现：使用VHDL或Verilog硬件描述语言把要实现的硬件功能描述出来，接着通过EDA工具不断仿真、修改和验证，直到芯片的逻辑功能完全正确。这种仿真我们一般称为前端仿真，简称前仿。前仿只验证芯片的逻辑功能是否正确，不考虑延时等因素。芯片公司内部一般也会设有数字IC验证工程师岗位，招聘工程师专门从事这个工作。加法器<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> adder(</span><br><span class="line">	<span class="keyword">input</span> x, y,</span><br><span class="line">	<span class="keyword">output</span> carry, out</span><br><span class="line">);</span><br><span class="line">	<span class="keyword">assign</span> &#123;out, carry&#125; = x + y;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure></li>
<li>逻辑综合：通过EDA工具就可以将HDL代码转换成具体的逻辑门电路<br><img src="https://cdn.staticaly.com/gh/qierenrongku/images@master/Pastedimage20230517224926.5a9nxw72a2g0.webp" alt="Pastedimage20230517224926"></li>
<li>仿真验证：通过逻辑综合生成的门级电路，已经包含了延时等各种信息，接下来还需要对这些门级电路进行进一步的静态时序分析和验证。为了提高工作效率，除了使用仿真软件，有时候也会借助FPGA平台进行验证。前端仿真发生在逻辑综合之前，专注于验证电路的逻辑功能是否正确；逻辑综合后的仿真，一般称为后端仿真，简称后仿。后端仿真会考虑延时等因素。后端仿真通过后，从HDL代码到生成门级网表电路，整个芯片的前端设计就结束了。</li>
<li>后端设计:对门级网表电路不断完善和优化，将其进一步设计成物理版图，也就是芯片代工厂做掩膜版需要的电路版图<br>  1、 DFT：Design For Test，可测试性设计。芯片内部一般会自带测试电路，如插入扫描链、引出JTAG调试接口。2、 布局规划：各个IP电路模块的摆放位置、时钟线综合、信号线的布局等。3、物理版图验证：检查设计规则、连线宽度、间距是否符合工艺要求和电气规则<h3 id="计算机体系结构"><a href="#计算机体系结构" class="headerlink" title="计算机体系结构"></a>计算机体系结构</h3><img src="https://cdn.staticaly.com/gh/qierenrongku/images@master/Pastedimage20230517225616.2p08maowzio0.webp" alt="Pastedimage20230517225616"><img src="https://cdn.staticaly.com/gh/qierenrongku/images@master/Pastedimage20230517225728.2z96mj2297q0.webp" alt="Pastedimage20230517225728"></li>
</ul>
<p>混合结构：SoC芯片内部的Cache层采用哈弗架构，集成了指令Cache和数据Cache；SoC芯片外部则采用冯·诺依曼架构，工程实现简单；先到这两个Cache中看看要读取的数据是不是已经缓存到这里了，如果没有缓存命中，再到内存中读取<br><img src="https://cdn.staticaly.com/gh/qierenrongku/images@master/Pastedimage20230517230032.1vuezevjt44g.webp" alt="Pastedimage20230517230032"></p>
<h3 id="CPU性能提升：流水线"><a href="#CPU性能提升：流水线" class="headerlink" title="CPU性能提升：流水线"></a>CPU性能提升：流水线</h3><p><img src="https://cdn.staticaly.com/gh/qierenrongku/images@master/Pastedimage20230517230446.2d2jj3gge9us.webp" alt="Pastedimage20230517230446"></p>
<h3 id="总线和地址"><a href="#总线和地址" class="headerlink" title="总线和地址"></a>总线和地址</h3><p>地址：CPU管脚发出的信号，也就是存储单元对应的编号，即地址(CPU管脚发出的一组地址控制信号，在经过译码器译码)<br>总线：总线其实就是各种数字信号的集合，包括地址信号、数据信号、控制信号等</p>
<h3 id="指令集和微架构"><a href="#指令集和微架构" class="headerlink" title="指令集和微架构"></a>指令集和微架构</h3><p>图灵原型机的基本思想是：任何复杂的运算都可以分解为有限个基本指令的组合来完成。我们的CPU在设计的时候就是这么干的，只支持有限个基本的运算指令，如加、减、乘、与、或、非、移位、跳转等。这些指令通过不同的组合，可以构成不同的指令序列（程序），实现不同的逻辑功能。<br>不同架构的处理器支持的指令类型是不同的。ARM架构的处理器只支持ARM指令，X86架构的处理器只支持X86指令。如果你在ARM架构的处理器上运行X86指令，就无法运行，报未定义指令的错误，因为ARM架构的处理器只支持ARM指令集中定义的指令。CPU支持的有限个指令的集合，我们称之为指令集。<br>微架构，对应的英文是Microarchitecture，也就是处理器架构。集成电路工程师在设计处理器时，会按照指令集规定的指令，设计具体的译码和运算电路来支持这些指令的运行；指令集在CPU处理器内部的具体硬件电路的实现，我们就称为微架构。一套相同的指令集，可以由不同形式的电路实现，可以有不同的微架构。</p>
<h2 id="ARM体系结构与汇编语言"><a href="#ARM体系结构与汇编语言" class="headerlink" title="ARM体系结构与汇编语言"></a>ARM体系结构与汇编语言</h2><p>计算机的指令集一般可分为4种：复杂指令集（CISC）、精简指令集（RISC）、显式并行指令集（EPIC）和超长指令字指令集（VLIW）</p>
<h3 id="ARM寻址方式"><a href="#ARM寻址方式" class="headerlink" title="ARM寻址方式"></a>ARM寻址方式</h3><ul>
<li>寄存器寻址：通过寄存器名就可以直接对寄存器中的数据进行读写</li>
<li>立即数寻址：在立即数寻址中，ARM指令中的操作数为一个常数。立即数以＃为前缀，0x前缀表示该立即数为十六进制，不加前缀默认是十进制。</li>
<li>寄存器偏移寻址：</li>
<li>寄存器间接寻址：</li>
<li>基址寻址：</li>
<li>多寄存器寻址：</li>
<li>相对寻址：<h3 id="c和汇编混合编程"><a href="#c和汇编混合编程" class="headerlink" title="c和汇编混合编程"></a>c和汇编混合编程</h3>下载交叉编译链 gcc-linaro-4.9.4-2017.01-x86_64_arm-linux-gnueabihf.tar.xz<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://releases.linaro.org/components/toolchain/binaries/4.9-2017.01/arm-linux-gnueabihf/gcc-linaro-4.9.4-2017.01-x86_64_arm-linux-gnueabihf.tar.xz</span><br></pre></td></tr></table></figure>
创建一个文件夹并把编译链解压到该文件夹<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /usr/local/arm</span><br><span class="line">sudo tar -vxf gcc-linaro-4.9.4-2017.01-x86_64_arm-linux-gnueabihf.tar.xz -C /usr/local/arm</span><br></pre></td></tr></table></figure>
配置环境变量<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、打开编辑~/.bashrc 文件</span><br><span class="line">sudo vim ~/.bashrc</span><br><span class="line">2、在最底部添加以下内容</span><br><span class="line">export PATH=$PATH:/usr/local/arm/gcc-linaro-4.9.4-2017.01-x86_64_arm-linux-gnueabihf/bin</span><br><span class="line">3、使环境变量立即生效</span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>
安装其他库<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install lsb-core lib32stdc++6</span><br></pre></td></tr></table></figure>
验证编译器是否安装成功（查看版本号命令）<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arm-linux-gnueabihf-gcc -v</span><br></pre></td></tr></table></figure>
<h2 id="程序的编译、链接、安装和运行"><a href="#程序的编译、链接、安装和运行" class="headerlink" title="程序的编译、链接、安装和运行"></a>程序的编译、链接、安装和运行</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">readelf -h a.out </span><br><span class="line">ELF 头：</span><br><span class="line">  Magic：   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00 </span><br><span class="line">  类别:                              ELF32</span><br><span class="line">  数据:                              2 补码，小端序 (little endian)</span><br><span class="line">  Version:                           1 (current)</span><br><span class="line">  OS/ABI:                            UNIX - System V</span><br><span class="line">  ABI 版本:                          0</span><br><span class="line">  类型:                              EXEC (可执行文件)</span><br><span class="line">  系统架构:                          ARM</span><br><span class="line">  版本:                              0x1</span><br><span class="line">  入口点地址：               0x10328</span><br><span class="line">  程序头起点：          52 (bytes into file)</span><br><span class="line">  Start of section headers:          68216 (bytes into file)</span><br><span class="line">  标志：             0x5000200, Version5 EABI, soft-float ABI</span><br><span class="line">  Size of this header:               52 (bytes)</span><br><span class="line">  Size of program headers:           32 (bytes)</span><br><span class="line">  Number of program headers:         9</span><br><span class="line">  Size of section headers:           40 (bytes)</span><br><span class="line">  Number of section headers:         29</span><br><span class="line">  Section header string table index: 28</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">readelf -S a.out </span><br><span class="line">There are 29 section headers, starting at offset 0x10a78:</span><br><span class="line"></span><br><span class="line">节头：</span><br><span class="line">  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al</span><br><span class="line">  [ 0]                   NULL            00000000 000000 000000 00      0   0  0</span><br><span class="line">  [ 1] .interp           PROGBITS        00010154 000154 000013 00   A  0   0  1</span><br><span class="line">  [ 2] .note.gnu.bu[...] NOTE            00010168 000168 000024 00   A  0   0  4</span><br><span class="line">  [ 3] .note.ABI-tag     NOTE            0001018c 00018c 000020 00   A  0   0  4</span><br><span class="line">  [ 4] .gnu.hash         GNU_HASH        000101ac 0001ac 00002c 04   A  5   0  4</span><br><span class="line">  [ 5] .dynsym           DYNSYM          000101d8 0001d8 000050 10   A  6   1  4</span><br><span class="line">  [ 6] .dynstr           STRTAB          00010228 000228 00004e 00   A  0   0  1</span><br><span class="line">  [ 7] .gnu.version      VERSYM          00010276 000276 00000a 02   A  5   0  2</span><br><span class="line">  [ 8] .gnu.version_r    VERNEED         00010280 000280 000030 00   A  6   1  4</span><br><span class="line">  [ 9] .rel.dyn          REL             000102b0 0002b0 000008 08   A  5   0  4</span><br><span class="line">  [10] .rel.plt          REL             000102b8 0002b8 000020 08  AI  5  21  4</span><br><span class="line">  [11] .init             PROGBITS        000102d8 0002d8 00000c 00  AX  0   0  4</span><br><span class="line">  [12] .plt              PROGBITS        000102e4 0002e4 000044 04  AX  0   0  4</span><br><span class="line">  [13] .text             PROGBITS        00010328 000328 0001b4 00  AX  0   0  4</span><br><span class="line">  [14] .fini             PROGBITS        000104dc 0004dc 000008 00  AX  0   0  4</span><br><span class="line">  [15] .rodata           PROGBITS        000104e4 0004e4 000134 00   A  0   0  4</span><br><span class="line">  [16] .ARM.exidx        ARM_EXIDX       00010618 000618 000008 00  AL 13   0  4</span><br><span class="line">  [17] .eh_frame         PROGBITS        00010620 000620 000004 00   A  0   0  4</span><br><span class="line">  [18] .init_array       INIT_ARRAY      0002ff10 00ff10 000004 04  WA  0   0  4</span><br><span class="line">  [19] .fini_array       FINI_ARRAY      0002ff14 00ff14 000004 04  WA  0   0  4</span><br><span class="line">  [20] .dynamic          DYNAMIC         0002ff18 00ff18 0000e8 08  WA  6   0  4</span><br><span class="line">  [21] .got              PROGBITS        00030000 010000 000024 04  WA  0   0  4</span><br><span class="line">  [22] .data             PROGBITS        00030024 010024 000010 00  WA  0   0  4</span><br><span class="line">  [23] .bss              NOBITS          00030034 010034 00000c 00  WA  0   0  4</span><br><span class="line">  [24] .comment          PROGBITS        00000000 010034 000025 01  MS  0   0  1</span><br><span class="line">  [25] .ARM.attributes   ARM_ATTRIBUTES  00000000 010059 00002a 00      0   0  1</span><br><span class="line">  [26] .symtab           SYMTAB          00000000 010084 0006d0 10     27  85  4</span><br><span class="line">  [27] .strtab           STRTAB          00000000 010754 00021d 00      0   0  1</span><br><span class="line">  [28] .shstrtab         STRTAB          00000000 010971 000105 00      0   0  1</span><br><span class="line">Key to Flags:</span><br><span class="line">  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),</span><br><span class="line">  L (link order), O (extra OS processing required), G (group), T (TLS),</span><br><span class="line">  C (compressed), x (unknown), o (OS specific), E (exclude),</span><br><span class="line">  D (mbind), y (purecode), p (processor specific)</span><br></pre></td></tr></table></figure>

<p>一个可执行文件通常由不同的段（section）构成：代码段、数据段、BSS段、只读数据段等。每个section用一个section header来描述，包括段名、段的类型、段的起始地址、段的偏移和段的大小等。一个可执行文件中的每一个section都有一个section header，将这些section headers集中放到一起，就是section header table，翻译成中文就是节头表。我们可以使用readelf-S命令来查看一个可执行文件的节头表。</p>
<p>一个可执行文件的基本构成：一个可执行文件由一系列section组成，section header table自身也是以一个section的形式存储在可执行文件中的。section header table里的各个section header用来描述各个section的名称、类型、起始地址、大小等信息。除此之外，可执行文件还会有一个文件头ELF header，用来描述文件类型、要运行的处理器平台、入口地址等信息。当程序运行时，加载器会根据此文件头来获取可执行文件的一些信息。</p>
<p><img src="https://cdn.staticaly.com/gh/qierenrongku/images@master/Pastedimage20230522230824.4u41dgtghes0.webp" alt="Pastedimage20230522230824"></p>
<p>函数翻译成二进制指令放在代码段中，初始化的全局变量和静态局部变量放在数据段中,未初始化的全局变量和静态变量会放置在BSS段<br>程序中定义的一些字符串、printf函数打印的字符串常量则放置在只读数据段.rodata</p>
<h3 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h3><p>通过＃pragma预处理命令可以设定编译器的状态，指示编译器完成一些特定的动作。<br>● ＃pragma pack([n])：指示结构体和联合成员的对齐方式。<br>● ＃pragma message(“string”)：在编译信息输出窗口打印自己的文本信息。<br>● ＃pragma warning：有选择地改变编译器的警告信息行为。<br>● ＃pragma once：在头文件中添加这条指令，可以防止头文件多次编译。</p>
<h3 id="符号表与重定位"><a href="#符号表与重定位" class="headerlink" title="符号表与重定位"></a>符号表与重定位</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"> readelf -s a.out </span><br><span class="line"></span><br><span class="line">Symbol table &#x27;.dynsym&#x27; contains 5 entries:</span><br><span class="line">   Num:    Value  Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     0: 00000000     0 NOTYPE  LOCAL  DEFAULT  UND </span><br><span class="line">     1: 00000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__</span><br><span class="line">     2: 00000000     0 FUNC    GLOBAL DEFAULT  UND printf@GLIBC_2.4 (3)</span><br><span class="line">     3: 00000000     0 FUNC    GLOBAL DEFAULT  UND abort@GLIBC_2.4 (3)</span><br><span class="line">     4: 00000000     0 FUNC    GLOBAL DEFAULT  UND _[...]@GLIBC_2.34 (2)</span><br><span class="line"></span><br><span class="line">Symbol table &#x27;.symtab&#x27; contains 109 entries:</span><br><span class="line">   Num:    Value  Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     0: 00000000     0 NOTYPE  LOCAL  DEFAULT  UND </span><br><span class="line">     1: 00010154     0 SECTION LOCAL  DEFAULT    1 .interp</span><br><span class="line">     2: 00010168     0 SECTION LOCAL  DEFAULT    2 .note.gnu.build-id</span><br><span class="line">     3: 0001018c     0 SECTION LOCAL  DEFAULT    3 .note.ABI-tag</span><br><span class="line">     4: 000101ac     0 SECTION LOCAL  DEFAULT    4 .gnu.hash</span><br><span class="line">     5: 000101d8     0 SECTION LOCAL  DEFAULT    5 .dynsym</span><br><span class="line">     6: 00010228     0 SECTION LOCAL  DEFAULT    6 .dynstr</span><br><span class="line">     7: 00010276     0 SECTION LOCAL  DEFAULT    7 .gnu.version</span><br><span class="line">     8: 00010280     0 SECTION LOCAL  DEFAULT    8 .gnu.version_r</span><br><span class="line">     9: 000102b0     0 SECTION LOCAL  DEFAULT    9 .rel.dyn</span><br><span class="line">    10: 000102b8     0 SECTION LOCAL  DEFAULT   10 .rel.plt</span><br><span class="line">    11: 000102d8     0 SECTION LOCAL  DEFAULT   11 .init</span><br><span class="line">    12: 000102e4     0 SECTION LOCAL  DEFAULT   12 .plt</span><br><span class="line">    13: 00010328     0 SECTION LOCAL  DEFAULT   13 .text</span><br><span class="line">    14: 000104dc     0 SECTION LOCAL  DEFAULT   14 .fini</span><br><span class="line">    15: 000104e4     0 SECTION LOCAL  DEFAULT   15 .rodata</span><br><span class="line">    16: 00010618     0 SECTION LOCAL  DEFAULT   16 .ARM.exidx</span><br><span class="line">    17: 00010620     0 SECTION LOCAL  DEFAULT   17 .eh_frame</span><br><span class="line">    18: 0002ff10     0 SECTION LOCAL  DEFAULT   18 .init_array</span><br><span class="line">    19: 0002ff14     0 SECTION LOCAL  DEFAULT   19 .fini_array</span><br><span class="line">    20: 0002ff18     0 SECTION LOCAL  DEFAULT   20 .dynamic</span><br><span class="line">    21: 00030000     0 SECTION LOCAL  DEFAULT   21 .got</span><br><span class="line">    22: 00030024     0 SECTION LOCAL  DEFAULT   22 .data</span><br><span class="line">    23: 00030034     0 SECTION LOCAL  DEFAULT   23 .bss</span><br><span class="line">    24: 00000000     0 SECTION LOCAL  DEFAULT   24 .comment</span><br><span class="line">    25: 00000000     0 SECTION LOCAL  DEFAULT   25 .ARM.attributes</span><br><span class="line">    26: 00000000     0 FILE    LOCAL  DEFAULT  ABS crt1.o</span><br><span class="line">    27: 0001018c     0 NOTYPE  LOCAL  DEFAULT    3 $d</span><br><span class="line">    28: 0001018c    32 OBJECT  LOCAL  DEFAULT    3 __abi_tag</span><br><span class="line">    29: 00010328     0 NOTYPE  LOCAL  DEFAULT   13 $a</span><br><span class="line">    30: 00010364     0 NOTYPE  LOCAL  DEFAULT   13 $d</span><br><span class="line">    31: 00010618     0 NOTYPE  LOCAL  DEFAULT   16 $d</span><br><span class="line">    32: 000104e4     0 NOTYPE  LOCAL  DEFAULT   15 $d</span><br><span class="line">    33: 00030024     0 NOTYPE  LOCAL  DEFAULT   22 $d</span><br><span class="line">    34: 00000000     0 FILE    LOCAL  DEFAULT  ABS crti.o</span><br><span class="line">    35: 0001036c     0 NOTYPE  LOCAL  DEFAULT   13 $a</span><br><span class="line">    36: 0001036c     0 FUNC    LOCAL  DEFAULT   13 call_weak_fn</span><br><span class="line">    37: 00010388     0 NOTYPE  LOCAL  DEFAULT   13 $d</span><br><span class="line">    38: 000102d8     0 NOTYPE  LOCAL  DEFAULT   11 $a</span><br><span class="line">    39: 000104dc     0 NOTYPE  LOCAL  DEFAULT   14 $a</span><br><span class="line">    40: 00000000     0 FILE    LOCAL  DEFAULT  ABS crtn.o</span><br><span class="line">    41: 000102e0     0 NOTYPE  LOCAL  DEFAULT   11 $a</span><br><span class="line">    42: 000104e0     0 NOTYPE  LOCAL  DEFAULT   14 $a</span><br><span class="line">    43: 00000000     0 FILE    LOCAL  DEFAULT  ABS crtstuff.c</span><br><span class="line">    44: 000104e8     0 NOTYPE  LOCAL  DEFAULT   15 $d</span><br><span class="line">    45: 000104e8     0 OBJECT  LOCAL  DEFAULT   15 all_implied_fbits</span><br><span class="line">    46: 00010390     0 NOTYPE  LOCAL  DEFAULT   13 $a</span><br><span class="line">    47: 00010390     0 FUNC    LOCAL  DEFAULT   13 deregister_tm_clones</span><br><span class="line">    48: 000103b0     0 NOTYPE  LOCAL  DEFAULT   13 $d</span><br><span class="line">    49: 000103bc     0 NOTYPE  LOCAL  DEFAULT   13 $a</span><br><span class="line">    50: 000103bc     0 FUNC    LOCAL  DEFAULT   13 register_tm_clones</span><br><span class="line">    51: 000103e8     0 NOTYPE  LOCAL  DEFAULT   13 $d</span><br><span class="line">    52: 00030028     0 NOTYPE  LOCAL  DEFAULT   22 $d</span><br><span class="line">    53: 000103f4     0 NOTYPE  LOCAL  DEFAULT   13 $a</span><br><span class="line">    54: 000103f4     0 FUNC    LOCAL  DEFAULT   13 __do_global_dtors_aux</span><br><span class="line">    55: 00010418     0 NOTYPE  LOCAL  DEFAULT   13 $d</span><br><span class="line">    56: 00030034     1 OBJECT  LOCAL  DEFAULT   23 completed.0</span><br><span class="line">    57: 0002ff14     0 NOTYPE  LOCAL  DEFAULT   19 $d</span><br><span class="line">    58: 0002ff14     0 OBJECT  LOCAL  DEFAULT   19 __do_global_dtor[...]</span><br><span class="line">    59: 0001041c     0 NOTYPE  LOCAL  DEFAULT   13 $a</span><br><span class="line">    60: 0001041c     0 FUNC    LOCAL  DEFAULT   13 frame_dummy</span><br><span class="line">    61: 0002ff10     0 NOTYPE  LOCAL  DEFAULT   18 $d</span><br><span class="line">    62: 0002ff10     0 OBJECT  LOCAL  DEFAULT   18 __frame_dummy_in[...]</span><br><span class="line">    63: 00030034     0 NOTYPE  LOCAL  DEFAULT   23 $d</span><br><span class="line">    64: 00000000     0 FILE    LOCAL  DEFAULT  ABS main.c</span><br><span class="line">    65: 0003002c     0 NOTYPE  LOCAL  DEFAULT   22 $d</span><br><span class="line">    66: 00030038     0 NOTYPE  LOCAL  DEFAULT   23 $d</span><br><span class="line">    67: 00010578     0 NOTYPE  LOCAL  DEFAULT   15 $d</span><br><span class="line">    68: 00010420     0 NOTYPE  LOCAL  DEFAULT   13 $a</span><br><span class="line">    69: 00010474     0 NOTYPE  LOCAL  DEFAULT   13 $d</span><br><span class="line">    70: 0003003c     4 OBJECT  LOCAL  DEFAULT   23 uninit_local_val.1</span><br><span class="line">    71: 00030030     4 OBJECT  LOCAL  DEFAULT   22 local_val.0</span><br><span class="line">    72: 00000000     0 FILE    LOCAL  DEFAULT  ABS sub.c</span><br><span class="line">    73: 0001047c     0 NOTYPE  LOCAL  DEFAULT   13 $a</span><br><span class="line">    74: 00000000     0 FILE    LOCAL  DEFAULT  ABS crtstuff.c</span><br><span class="line">    75: 00010588     0 NOTYPE  LOCAL  DEFAULT   15 $d</span><br><span class="line">    76: 00010588     0 OBJECT  LOCAL  DEFAULT   15 all_implied_fbits</span><br><span class="line">    77: 00010620     0 NOTYPE  LOCAL  DEFAULT   17 $d</span><br><span class="line">    78: 00010620     0 OBJECT  LOCAL  DEFAULT   17 __FRAME_END__</span><br><span class="line">    79: 00000000     0 FILE    LOCAL  DEFAULT  ABS </span><br><span class="line">    80: 0002ff18     0 OBJECT  LOCAL  DEFAULT   20 _DYNAMIC</span><br><span class="line">    81: 00030000     0 OBJECT  LOCAL  DEFAULT   21 _GLOBAL_OFFSET_TABLE_</span><br><span class="line">    82: 000102e4     0 NOTYPE  LOCAL  DEFAULT   12 $a</span><br><span class="line">    83: 000102f4     0 NOTYPE  LOCAL  DEFAULT   12 $d</span><br><span class="line">    84: 000102f8     0 NOTYPE  LOCAL  DEFAULT   12 $a</span><br><span class="line">    85: 00030038     4 OBJECT  GLOBAL DEFAULT   23 uninit_val</span><br><span class="line">    86: 00000000     0 FUNC    GLOBAL DEFAULT  UND __libc_start_mai[...]</span><br><span class="line">    87: 00030024     0 NOTYPE  WEAK   DEFAULT   22 data_start</span><br><span class="line">    88: 0001047c    48 FUNC    GLOBAL DEFAULT   13 add</span><br><span class="line">    89: 00000000     0 FUNC    GLOBAL DEFAULT  UND printf@GLIBC_2.4</span><br><span class="line">    90: 00030034     0 NOTYPE  GLOBAL DEFAULT   23 __bss_start__</span><br><span class="line">    91: 00030040     0 NOTYPE  GLOBAL DEFAULT   23 _bss_end__</span><br><span class="line">    92: 00030034     0 NOTYPE  GLOBAL DEFAULT   22 _edata</span><br><span class="line">    93: 000104dc     0 FUNC    GLOBAL HIDDEN    14 _fini</span><br><span class="line">    94: 00030040     0 NOTYPE  GLOBAL DEFAULT   23 __bss_end__</span><br><span class="line">    95: 0003002c     4 OBJECT  GLOBAL DEFAULT   22 global_val</span><br><span class="line">    96: 00030024     0 NOTYPE  GLOBAL DEFAULT   22 __data_start</span><br><span class="line">    97: 00000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__</span><br><span class="line">    98: 00030028     0 OBJECT  GLOBAL HIDDEN    22 __dso_handle</span><br><span class="line">    99: 000104e4     4 OBJECT  GLOBAL DEFAULT   15 _IO_stdin_used</span><br><span class="line">   100: 00030040     0 NOTYPE  GLOBAL DEFAULT   23 _end</span><br><span class="line">   101: 00010328     0 FUNC    GLOBAL DEFAULT   13 _start</span><br><span class="line">   102: 00030040     0 NOTYPE  GLOBAL DEFAULT   23 __end__</span><br><span class="line">   103: 00030034     0 NOTYPE  GLOBAL DEFAULT   23 __bss_start</span><br><span class="line">   104: 00010420    92 FUNC    GLOBAL DEFAULT   13 main</span><br><span class="line">   105: 00030034     0 OBJECT  GLOBAL HIDDEN    22 __TMC_END__</span><br><span class="line">   106: 000104ac    48 FUNC    GLOBAL DEFAULT   13 sub</span><br><span class="line">   107: 00000000     0 FUNC    GLOBAL DEFAULT  UND abort@GLIBC_2.4</span><br><span class="line">   108: 000102d8     0 FUNC    GLOBAL HIDDEN    11 _init</span><br></pre></td></tr></table></figure>

<p>符号表主要用来保存源程序中各种符号的信息，包括符号的地址、类型、占用空间的大小<br>符号的类型主要有以下几种：<br>● OBJECT：对象类型，一般用来表示我们在程序中定义的变量。<br>● FUNC：关联的是函数名或其他可引用的可执行代码。<br>● FILE：该符号关联的是当前目标文件的名称。<br>● SECTION：表明该符号关联的是一个section，主要用来重定位。<br>● COMMON：表明该符号是一个公用块数据对象，是一个全局弱符号，在当前文件中未分配空间。<br>● TLS：表明该符号对应的变量存储在线程局部存储中。<br>● NOTYPE：未指定类型，或者目前还不知道该符号类型。</p>
<h3 id="程序的安装"><a href="#程序的安装" class="headerlink" title="程序的安装"></a>程序的安装</h3><p>软件安装的过程其实就是将一个可执行文件安装到ROM的过程<br>在Linux环境下，我们一般将可执行文件直接复制到系统的官方路径&#x2F;bin、&#x2F;sbin、&#x2F;usr&#x2F;bin下，程序运行时直接从这些系统默认的路径下去查找可执行文件，将其加载到内存运行。</p>
<h4 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;hello world\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">gcc main.c -o a.out</span><br></pre></td></tr></table></figure>
<h3 id="制作软件包"><a href="#制作软件包" class="headerlink" title="制作软件包"></a>制作软件包</h3><p>Linux操作系统一般可分为两派：Redhat系和Debian系。Redhat系使用RPM包管理机制，而Debian系，像Debian、Ubuntu等操作系统则使用deb包管理机制<br>一个成熟的发布软件里，除了可执行文件，一般还会有配套的文档说明、图标等，程序开发者将这些文档一起打包发布，提供自动安装的功能，更方便用户下载和安装。在制作deb包时，除了可执行文件，还需要一些控制信息来描述这个安装包，如软件的版本、作者、安装包要安装的路径等，这些控制信息放在一个叫作control的文件里</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">qrrk@qrrk-virtual-machine:~/桌面$ tree helloworld/</span><br><span class="line">helloworld/</span><br><span class="line">├── DEBIAN</span><br><span class="line">│   └── control</span><br><span class="line">└── usr</span><br><span class="line">    └── local</span><br><span class="line">        └── bin</span><br><span class="line">            └── helloworld  # 可执行文件</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># control文件</span><br><span class="line">package:helloworld</span><br><span class="line">version:1.0</span><br><span class="line">architecture:i386</span><br><span class="line">maintainer:wit</span><br><span class="line">description: deb package demo</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">qrrk@qrrk-virtual-machine:~/桌面$ dpkg -b helloworld/ helloworld_1.0_i386.deb</span><br><span class="line">qrrk@qrrk-virtual-machine:~/桌面$ sudo dpkg -i helloworld_1.0_i386.deb </span><br><span class="line">正在选中未选择的软件包 helloworld:i386。</span><br><span class="line">(正在读取数据库 ... 系统当前共安装有 218803 个文件和目录。)</span><br><span class="line">准备解压 helloworld_1.0_i386.deb  ...</span><br><span class="line">正在解压 helloworld:i386 (1.0) ...</span><br><span class="line">正在设置 helloworld:i386 (1.0) ...</span><br><span class="line">qrrk@qrrk-virtual-machine:~/桌面$ helloworld</span><br><span class="line">hello world</span><br><span class="line">qrrk@qrrk-virtual-machine:~/桌面$ whereis helloworld </span><br><span class="line">helloworld: /usr/local/bin/helloworld</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dpkg -P helloworld 卸载程序及配置文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dpkg -r helloworldr 卸载helloworld程序</span></span><br></pre></td></tr></table></figure>

<h3 id="main函数分析"><a href="#main函数分析" class="headerlink" title="main函数分析"></a>main函数分析</h3><p>编译器在编译一个工程时，默认的程序入口是_start符号，而不是main。符号main是一个约定符号，它用来告诉编译器在一个项目中哪里是程序的入口点。程序员在开发一个项目时，也会遵守这个约定，使用main()函数作为项目的入口函数。其实在main()函数运行之前，已经有“先头部队”代码提前运行了：它们主要完成运行main()函数之前的一些初始化工作，如初始化堆栈指针等<br>● C语言运行的基本堆栈环境、进程环境。<br>● 动态库的加载、释放、初始化、清理等工作。<br>● 向main()函数传参argc、argv，调用main()函数执行。<br>● 在main()函数退出后，调用exit()函数，结束进程的运行</p>
<p>在嵌入式系统裸机环境下，系统上电后要初始化时钟、内存，然后设置堆栈指针，而在普通的操作系统环境下，内存等各种硬件设备已经工作，堆栈环境也已经初始化完毕，不需要做这一部分工作了，保存一些上下文环境后就可以直接跳到第一个C语言入口函数：__libc_start_main<br>__libc_start_main函数大致流程如下：首先设置程序运行的进程环境，加载共享库，解析用户输入的参数，将参数传递给main()函数，最后调用main()函数运行。main()函数运行结束后，再调用exit函数结束整个进程</p>
<h3 id="链接静态库"><a href="#链接静态库" class="headerlink" title="链接静态库"></a>链接静态库</h3><p>test.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a / b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span>, <span class="type">int</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    sum = add(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;sum=%d\n&quot;</span>, sum);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">qrrk@qrrk-virtual-machine:~/桌面/study6$ cd ../study7</span><br><span class="line">qrrk@qrrk-virtual-machine:~/桌面/study7$ gcc -c test.c </span><br><span class="line">qrrk@qrrk-virtual-machine:~/桌面/study7$ ar rcs libtest.a test.o</span><br><span class="line">qrrk@qrrk-virtual-machine:~/桌面/study7$ gcc main.c -L. -ltest</span><br><span class="line">qrrk@qrrk-virtual-machine:~/桌面/study7$ ./a.out </span><br><span class="line">sum=3</span><br></pre></td></tr></table></figure>

<p>使用ar命令制作静态库时，一些常用的参数介绍如下。<br>● -c：禁止在创建库时产生的正常消息。<br>● -r：如果指定的文件已经在库中存在，则替换它。<br>● -s：无论库是否更新都强制重新生成新的符号表。<br>● -d：从库中删除指定的文件。<br>● -o：对压缩文档成员进行排序。<br>● -q：向库中追加指定文件。<br>● -t：打印库中的目标文件。<br>● -x：解压库中的目标文件。</p>
<h3 id="动态链接"><a href="#动态链接" class="headerlink" title="动态链接"></a>动态链接</h3><p>静态链接的缺点：生成的可执行文件体积较大，当多个程序引用相同的公共代码时，这些公共代码会多次加载到内存，浪费内存资源。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">qrrk@qrrk-virtual-machine:~/桌面/study7$ gcc -fPIC -shared add.c sub.c mul.c div.c -o libtest.so</span><br><span class="line">qrrk@qrrk-virtual-machine:~/桌面/study7$ gcc main.c libtest.so </span><br><span class="line">qrrk@qrrk-virtual-machine:~/桌面/study7$ ./a.out </span><br><span class="line">./a.out: error while loading shared libraries: libtest.so: cannot open shared object file: No such file or directory</span><br><span class="line">qrrk@qrrk-virtual-machine:~/桌面/study7$ sudo cp libtest.so /usr/lib</span><br><span class="line">[sudo] qrrk 的密码： </span><br><span class="line">qrrk@qrrk-virtual-machine:~/桌面/study7$ ./a.out </span><br><span class="line">sum=3</span><br></pre></td></tr></table></figure>
<p>可执行文件a.out是采用动态链接生成的，所以在运行a.out之前，libtest.so这个动态链接库要放到&#x2F;lib、&#x2F;usr&#x2F;lib等系统默认的库路径下，否则a.out就会动态链接失败，无法正常运行</p>
<p>在Linux环境下，当我们运行一个程序时，操作系统首先会给程序fork一个子进程，接着动态链接器被加载到内存，操作系统将控制权交给动态链接器，让动态链接器完成动态库的加载和重定位操作，最后跳转到要运行的程序</p>

        </div>

        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/c/">#c</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2023/07/22/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%BB%AA%E8%AE%BA/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">数据结构-绪论</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2023/05/16/pytest-start/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">pytest start</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2024&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">且任容枯</a>
        </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>








<div class="post-scripts">
    
</div>



</body>
</html>
